@page "/login"
@inject NavigationManager Nav

<h3>Đăng nhập Mini Shopee</h3>
<p>Tài khoản demo: admin@local / Admin123$; staff@local / Staff123$; customer@local / Customer123$; vip@local / Vip123$</p>

@if (!string.IsNullOrWhiteSpace(errorMessage))
{
    <p class="alert alert-warning">@errorMessage</p>
}

<form method="post" action="/auth/login-form" class="w-50">
    <div class="mb-3">
        <label>Email</label>
        <input class="form-control" type="email" name="email" required />
    </div>
    <div class="mb-3">
        <label>Mật khẩu</label>
        <input class="form-control" type="password" name="password" required />
    </div>
    <button class="btn btn-primary">Đăng nhập</button>
    <a class="btn btn-link" href="/register">Chưa có tài khoản? Đăng ký</a>
</form>

@code {
    private string? errorMessage;

    protected override void OnInitialized()
    {
        var uri = Nav.ToAbsoluteUri(Nav.Uri);
        var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);
        if (!query.TryGetValue("error", out var error))
        {
            return;
        }

        errorMessage = error.ToString() switch
        {
            "blocked" => "Tài khoản không tồn tại hoặc đã bị khóa.",
            "bad_credentials" => "Sai email hoặc mật khẩu.",
            _ => "Đăng nhập thất bại."
        };
    }
}
