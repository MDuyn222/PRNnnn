@page "/register"
@inject NavigationManager Nav

<h3>Đăng ký tài khoản</h3>

@if (!string.IsNullOrWhiteSpace(errorMessage))
{
    <p class="alert alert-warning">@errorMessage</p>
}

<form method="post" action="/auth/register-form" class="w-50">
    <div class="mb-3">
        <label>Họ và tên</label>
        <input class="form-control" name="fullName" required />
    </div>
    <div class="mb-3">
        <label>Email</label>
        <input class="form-control" type="email" name="email" required />
    </div>
    <div class="mb-3">
        <label>Mật khẩu</label>
        <input class="form-control" type="password" name="password" required />
        <small>Mật khẩu cần tối thiểu 8 ký tự, có hoa/thường/số/ký tự đặc biệt.</small>
    </div>
    <div class="mb-3">
        <label>Nhập lại mật khẩu</label>
        <input class="form-control" type="password" name="confirmPassword" required />
    </div>
    <button class="btn btn-primary">Tạo tài khoản</button>
    <a class="btn btn-link" href="/login">Đã có tài khoản? Đăng nhập</a>
</form>

@code {
    private string? errorMessage;

    protected override void OnInitialized()
    {
        var uri = Nav.ToAbsoluteUri(Nav.Uri);
        var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);
        if (!query.TryGetValue("error", out var error))
        {
            return;
        }

        errorMessage = error.ToString() switch
        {
            "missing_fields" => "Vui lòng nhập đầy đủ thông tin.",
            "password_mismatch" => "Mật khẩu nhập lại không khớp.",
            "email_exists" => "Email đã tồn tại. Vui lòng dùng email khác.",
            "invalid_password" => "Mật khẩu chưa đúng định dạng yêu cầu.",
            _ => "Đăng ký thất bại."
        };
    }
}
