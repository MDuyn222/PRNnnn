@page "/"
@page "/home"
@using MiniShopee.Models
@inject MiniShopee.Services.CommerceService CommerceService
@inject MiniShopee.Services.CartState Cart
@inject AuthenticationStateProvider AuthStateProvider

<h3>Mini Shopee - Trang Home</h3>

<AuthorizeView>
    <Authorized>
        <p class="alert alert-info">Xin chÃ o @context.User.Identity?.Name, chÃºc báº¡n mua sáº¯m vui váº» ğŸ‰</p>
    </Authorized>
    <NotAuthorized>
        <p class="alert alert-info">Báº¡n cÃ³ thá»ƒ xem sáº£n pháº©m trÆ°á»›c. Äá»ƒ Ä‘áº·t hÃ ng, vui lÃ²ng <a href="/login">Ä‘Äƒng nháº­p</a> hoáº·c <a href="/register">Ä‘Äƒng kÃ½</a>.</p>
    </NotAuthorized>
</AuthorizeView>

@if (products.Count == 0)
{
    <p>Äang táº£i sáº£n pháº©m...</p>
}
else
{
    <div class="row row-cols-1 row-cols-md-3 g-3">
        @foreach (var p in products)
        {
            <div class="col">
                <div class="card p-3">
                    <h5>@p.Name</h5>
                    <p>@p.Description</p>
                    <b>@p.PriceVnd.ToString("N0") VND</b>
                    <small class="d-block">Tá»“n kho: @p.Stock</small>
                    <AuthorizeView>
                        <Authorized>
                            <button class="btn btn-sm btn-success mt-2" @onclick="() => AddToCart(p.Id)">ThÃªm vÃ o giá»</button>
                        </Authorized>
                        <NotAuthorized>
                            <a class="btn btn-sm btn-outline-primary mt-2" href="/login">ÄÄƒng nháº­p Ä‘á»ƒ mua</a>
                        </NotAuthorized>
                    </AuthorizeView>
                </div>
            </div>
        }
    </div>
}

@code {
    private List<Product> products = [];

    protected override async Task OnInitializedAsync()
    {
        _ = await AuthStateProvider.GetAuthenticationStateAsync();
        products = await CommerceService.GetProductsAsync();
    }

    private void AddToCart(int productId) => Cart.Add(productId);
}
